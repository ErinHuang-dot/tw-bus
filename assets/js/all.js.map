{"version":3,"sources":["all.js"],"names":["cityData","name","value","cityList","document","querySelector","select","str","forEach","item","innerHTML","citySelect","routeSearch","city","routeName","addEventListener","e","target","console","log","getCityRoute","searchReultRoute","routeData","axios","method","url","headers","GetAuthorizationHeader","then","response","data","RouteName","Zh_tw","DepartureStopNameZh","DestinationStopNameZh","error","casheData","reg","RegExp","filter","match","AppID","AppKey","GMTString","Date","toGMTString","ShaObj","jsSHA","setHMACKey","update","HMAC","getHMAC","Authorization"],"mappings":"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","file":"all.js","sourcesContent":["// 輸入或選取城市功能\nconst cityData = [\n  { name: '臺北市', value: 'Taipei' },\n  { name: '新北市', value: 'NewTaipei' },\n  { name: '桃園市', value: 'Taoyuan' },\n  { name: '臺中市', value: 'Taichung' },\n  { name: '臺南市', value: 'Tainan' },\n  { name: '高雄市', value: 'Kaohsiung' },\n  { name: '基隆市', value: 'Keelung' },\n  { name: '新竹市', value: 'Hsinchu' },\n  { name: '新竹縣', value: 'HsinchuCounty' },\n  { name: '苗栗縣', value: 'MiaoliCounty' },\n  { name: '彰化縣', value: 'ChanghuaCounty' },\n  { name: '南投縣', value: 'NantouCounty' },\n  { name: '雲林縣', value: 'YunlinCounty' },\n  { name: '嘉義縣', value: 'ChiayiCounty' },\n  { name: '嘉義市', value: 'Chiayi' },\n  { name: '屏東縣', value: 'PingtungCounty' },\n  { name: '宜蘭縣', value: 'YilanCounty' },\n  { name: '花蓮縣', value: 'HualienCounty' },\n  { name: '臺東縣', value: 'TaitungCounty' },\n  { name: '金門縣', value: 'KinmenCounty' },\n  { name: '澎湖縣', value: 'PenghuCounty' },\n  { name: '連江縣', value: 'LienchiangCounty' },\n]\n\nconst cityList = document.querySelector('#cityDataList');\nfunction select() {\n  let str = '';\n  cityData.forEach((item) => {\n    str +=`<option value=\"${item.value}\">${item.name}</option>`\n  })\n  cityList.innerHTML = str;\n}\nselect();\n\n// 輸入或選取公車路線功能\nconst citySelect = document.querySelector('#citySelect');\nconst routeSearch = document.querySelector('#routeSearch');\n\nlet city = '';\nlet routeName = '';\n\n\ncitySelect.addEventListener('change', function(e) {\n  city = e.target.value;\n  console.log('city', city);\n  getCityRoute(city); // 把city當作參數傳給 getCityRoute 執行\n})\n\nrouteSearch.addEventListener('blur', function(e) {\n  routeName = e.target.value;\n  console.log('route', routeName);\n})\n\n\n// 接市區公車路線資料\nconst searchReultRoute = document.querySelector('.search-info-s-body');\nlet routeData = [];\n\nfunction getCityRoute(city) {\n    axios({\n        method: 'get',\n        url: `https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/${city}?$format=JSON`,\n        headers: GetAuthorizationHeader()        \n    })\n        .then((response) => {\n            console.log('城市路線資料', response)\n            const routeData = response.data;\n\n            // 搜尋縣市後顯示\n            let str='';\n            routeData.forEach((item) => {\n              str += `\n                        <li class=\"mb-4\">\n                          <div class=\"search-result-card card border-0\">\n                              <div class=\"card-body p-0\">\n                                  <div class=\"card-body-top d-flex justify-content-between align-items-center\">\n                                      <h2 class=\"card-title text-secondary p-0\">${item.RouteName.Zh_tw}</h5>\n                                      <button type=\"button\"><i class=\"far fa-heart fs-3 text-secondary-cool1\"></i></button>\n                                  </div>\n                                  <div class=\"card-body-bottom d-flex justify-content-between align-items-center\">\n                                      <p class=\"card-text me-2\"><small>${item.DepartureStopNameZh}<i class=\"fas fa-arrows-alt-h px-2\"></i>${item.DestinationStopNameZh}</small></p>\n                                      <p class=\"card-text text-secondary-cool1\"><small>${city}</small></p>\n                                  </div>\n                              </div>\n                          </div>\n                        </li>                        \n              `\n            })\n          \n          searchReultRoute.innerHTML = \n          `\n          <div class=\"search-info-s-body-top\">\n                    <div class=\"form-check form-switch text-end pb-4\">\n                        <label class=\"form-check-label fs-5\" for=\"flexSwitchCheckDefault\">僅顯示提供無障礙車輛之路線</label>\n                        <input class=\"form-check-input ms-2\" type=\"checkbox\" role=\"switch\" id=\"flexSwitchCheckDefault\">\n                    </div>                      \n                </div>\n                <div class=\"search info-s-body-bottom\">\n                    <ul class=\"search-result-list mx-auto\">\n          ` + str + \n          `</ul>\n          </div>`;\n\n        })\n        .catch((error) => console.log('error', error))\n}\ngetCityRoute();\n\n// 搜尋縣市+路線後顯示\nlet casheData = routeData;\nrouteSearch.addEventListener('change', function(e) {\n  const reg = new RegExp(e.target.value, 'gi');\n  casheData = routeData.filter((item) => item.RouteName.Zh_tw.match(reg));\n  getCityRoute(city);\n})\n\n// TDX API 驗證\nfunction GetAuthorizationHeader() {\n  var AppID = 'f7c6d9e58f254fe5af3cd8ee9794906d';\n  var AppKey = '6lFzrDFGOczHY42h-Erlj21ftOo';\n\n  var GMTString = new Date().toGMTString();\n  var ShaObj = new jsSHA('SHA-1', 'TEXT');\n  ShaObj.setHMACKey(AppKey, 'TEXT');\n  ShaObj.update('x-date: ' + GMTString);\n  var HMAC = ShaObj.getHMAC('B64');\n  var Authorization = 'hmac username=\\\"' + AppID + '\\\", algorithm=\\\"hmac-sha1\\\", headers=\\\"x-date\\\", signature=\\\"' + HMAC + '\\\"';\n\n  return { 'Authorization': Authorization, 'X-Date': GMTString /*,'Accept-Encoding': 'gzip'*/ }; //如果要將js運行在伺服器，可額外加入 'Accept-Encoding': 'gzip'，要求壓縮以減少網路傳輸資料量\n}"]}